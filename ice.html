<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥è³€Tom ğŸ¤µ & Jackie ğŸ‘° æ–°å©šå¿«æ¨‚ ç™½é ­å•è€</title>
    <style>
        /* CSS V3.31 - æ›´æ–°èƒŒæ™¯åœ–ç‰‡ */
        :root {
            --mcd-red: #C00000;
            --mcd-yellow: #FFC72C;
            --mcd-light-yellow: #FFF8E1;
            --mcd-dark: #333333;
            --mcd-light: #F8F8F8;
            --mcd-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            /* V3.31: æ–°å¢èƒŒæ™¯åœ–ç‰‡è®Šæ•¸ */
            --mcd-background-img: url('wedding_background.jpg'); 
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            color: var(--mcd-dark);
            line-height: 1.6;
            
            /* V3.31: ä½¿ç”¨æ–°çš„èƒŒæ™¯åœ–ç‰‡ */
            background-image: var(--mcd-background-img); 
            background-size: cover; 
            background-attachment: fixed; 
            background-position: center center; 
            background-color: #e0e0e0; 
        }
        
        /* ------------------ åœ–ç‰‡æ©«å¹…å€å¡Š ------------------ */
        #banner-container {
            width: 100%;
            height: 300px; 
            overflow: hidden; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        #banner-img {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            display: block;
            object-position: 50% 55%; 
        }
        
        /* ------------------ ç¥è³€æ¨™é ­å€å¡Š ------------------ */
        #greeting {
            background-color: var(--mcd-red);
            color: white;
            padding: 20px 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px; 
        }

        #greeting h1 {
            margin: 0;
            font-size: 2.2em; 
            letter-spacing: 1px;
        }
        /* ------------------ çµæŸæ¨™é ­å€å¡Š ------------------ */

        /* ä¸»å®¹å™¨å¸ƒå±€ */
        main {
            display: flex;
            flex-wrap: wrap;
            padding: 0 20px 40px 20px; 
            gap: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }

        section {
            background-color: white; 
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--mcd-shadow);
            transition: transform 0.3s ease;
        }

        section h2 {
            color: var(--mcd-red);
            border-bottom: 3px solid var(--mcd-yellow);
            padding-bottom: 10px;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        /* å„å€å¡Šä½”æ¯” */
        #controls {
            flex-basis: 100%;
            padding: 0; 
        }

        #controls-content {
            padding: 25px 25px 0 25px;
            border-radius: 12px 12px 0 0;
            background-color: white;
        }
        
        /* èœå–®å€å¡Šè¨­ç½® */
        #menu {
            flex: 1 1 350px;
            min-width: 300px;
            order: 1;
        }
        
        #menu-content {
            padding: 0 0 10px 0; 
        }
        
        #menu h2 {
            position: sticky; 
            top: 0;
            background-color: white;
            z-index: 10;
            padding-top: 5px;
            margin-top: -5px;
        }

        #order-list {
            flex: 3 1 700px;
            order: 2;
        }
        
        /* RWD èª¿æ•´ */
        @media (max-width: 900px) {
            #menu {
                flex-basis: 100%;
                order: 2; 
            }
            #order-list {
                flex-basis: 100%;
                order: 1; 
            }
        }
        
        /* ------------------ èœå–®é …ç›®æ¨£å¼ ------------------ */

        /* èœå–®æ”¶åˆæ¨£å¼ - ä¸»æ¨™é¡Œ */
        .menu-category-title {
            color: var(--mcd-dark);
            margin-top: 20px;
            margin-bottom: 0;
            border-left: 5px solid var(--mcd-red);
            padding: 10px 0 10px 10px;
            font-size: 1.2em;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #f7f7f7;
            border-radius: 4px 4px 0 0;
            transition: background-color 0.15s;
        }

        .menu-category-title:hover {
            background-color: var(--mcd-light-yellow);
        }
        
        .menu-category-title::after {
            content: 'â–¼';
            margin-right: 10px;
            transition: transform 0.2s;
        }

        .menu-category-title.expanded::after {
            transform: rotate(180deg);
        }

        /* èœå–®å…§å®¹ï¼šç”± JS æ§åˆ¶ max-height */
        .menu-category-content {
            max-height: 0; 
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            padding: 0 10px;
            border: 1px solid #e0e0e0;
            border-top: none;
            border-radius: 0 0 4px 4px;
        }

        .menu-category-content.expanded {
            overflow-y: auto; 
            max-height: 1000px; 
            padding-bottom: 10px;
        }
        
        /* èœå–®å­æ¨™é¡Œ (DRINKSå°ˆç”¨) - V3.19: çµ±ä¸€ç”¨æ–¼æ‰€æœ‰å­åˆ†é¡ */
        .menu-sub-toggle {
            color: var(--mcd-dark);
            font-size: 1.1em;
            margin: 15px 0 0 0;
            padding: 8px 10px;
            background-color: #e9e9e9;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 4px;
            border-left: 3px solid var(--mcd-yellow);
            font-weight: bold;
        }

        .menu-sub-toggle:hover {
            background-color: #e0e0e0;
        }

        .menu-sub-toggle::after {
            content: 'â–¶';
            font-size: 0.8em;
            transition: transform 0.2s;
        }

        .menu-sub-toggle.expanded::after {
            transform: rotate(90deg);
        }

        /* èœå–®å­å…§å®¹ (DRINKSå°ˆç”¨) */
        .menu-sub-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            padding: 0 10px;
            border-left: 1px solid #e0e0e0;
            margin-bottom: 10px;
        }

        .menu-sub-content.expanded {
            max-height: 1000px; 
        }
        
        /* åƒ¹æ ¼æ–‡å­—æ¨£å¼ - æ‰€æœ‰éœ€å¼·èª¿åƒ¹æ ¼è®Šç‚ºç´…è‰²ç²—é«” */
        .menu-item {
            padding: 12px 5px;
            margin-bottom: 5px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            background-color: #ffffff;
            transition: background-color 0.15s, transform 0.1s;
        }

        .menu-item:hover {
            background-color: var(--mcd-light-yellow);
            border-color: var(--mcd-yellow);
            transform: translateY(-2px);
        }

        .menu-item strong {
            display: block;
            font-size: 1.1em;
            margin-bottom: 3px;
        }

        /* V3.23: é¡¯ç¤º Code */
        .menu-item strong .item-code {
            color: var(--mcd-red);
            font-size: 0.8em;
            margin-left: 8px;
        }

        .menu-item small {
            color: #777;
            font-size: 0.85em;
        }
        
        /* è©² class ç”¨æ–¼å°‡åƒ¹æ ¼è¨­ç‚ºç´…è‰²ç²—é«” */
        .menu-item small.price-red-bold {
            color: var(--mcd-red);
            font-weight: bold;
        }

        /* è¡¨æ ¼, æŒ‰éˆ•, ç¸½çµç­‰æ¨£å¼ä¿æŒä¸è®Š */
        table {
            width: 100%;
            border-collapse: separate; 
            border-spacing: 0;
            margin-top: 10px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }
        
        th {
            background-color: var(--mcd-red);
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9em;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        button {
            padding: 8px 15px;
            background-color: var(--mcd-yellow);
            color: var(--mcd-dark);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s, transform 0.1s;
        }

        button:hover {
            background-color: #ffb800; 
            transform: translateY(-1px);
        }
        
        #person-select {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            margin-right: 15px;
            min-width: 150px;
        }
        
        .select-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        #summary {
            margin-top: 25px; 
            padding: 15px 25px; 
            background-color: var(--mcd-yellow);
            border-radius: 0 0 12px 12px; 
            box-shadow: var(--mcd-shadow);
            color: var(--mcd-dark);
            font-size: 1.4em;
            text-align: right;
            border-top: 2px solid #ffb800;
        }

        #total-price {
            font-size: 1.1em;
            color: var(--mcd-red);
            margin-left: 10px;
            font-weight: bold;
        }

        footer {
            text-align: center;
            padding: 15px;
            color: #999;
            font-size: 0.8em;
        }
    </style>
</head>
<body>
    
    <div id="banner-container">
        <img id="banner-img" src="banner.jpg" alt="Tom & Jackie æ–°å©šå¿«æ¨‚">
    </div>
    
    <div id="greeting">
        <h1>ç¥è³€Tom ğŸ¤µ & Jackie ğŸ‘° æ–°å©šå¿«æ¨‚ ç™½é ­å•è€</h1>
    </div>

    <main>
        <section id="controls">
            <div id="controls-content">
                <h2>ğŸ¯ åˆ†é…è¨‚å–®</h2>
                <div class="select-group">
                    <label for="person-select" style="font-weight: bold;">é¸æ“‡è¨‚é¤äººï¼š</label>
                    <select id="person-select"></select>
                    <button id="add-order-btn" style="margin-left: 15px;">
                        + æ–°å¢è¨‚é¤äºº
                    </button>
                </div>
                <p style="margin-top: 15px; color: #555;">æ­¥é©Ÿï¼š 1. é¸æ“‡è¨‚é¤äºº (æˆ–æ–°å¢) â†’ 2. åœ¨å³é‚Šèœå–®é»é¸ä¸»é£Ÿ â†’ 3. å½ˆå‡ºè¦–çª—ç¢ºèªå¥—é¤/å–®é»åŠå‡ç´šã€‚</p>
            </div>
            
            <div id="summary">
                ç¸½è¨ˆé‡‘é¡ï¼š<span id="total-price">HK$ 0.00</span>
            </div>
        </section>
        
        <section id="menu">
            <h2>èœå–®é¸æ“‡</h2>
            <div id="menu-content">
                </div>
        </section>

        <section id="order-list">
            <h2>ğŸ“‹ é»é¤æ¸…å–®</h2>
            <div id="orders-container">
                </div>
        </section>
        
    </main>

    <footer>
        <p>éº¥ç•¶å‹é»é¤ç³»çµ± V3.31 (æ›´æ–°èƒŒæ™¯åœ–ç‰‡)</p>
    </footer>

    <script>
        // å›ºå®šäººååˆ—è¡¨ (åˆå§‹çš„ 14 ä½)
        const INITIAL_NAMES = [
            "Jackie", "Tom", "Priscilla", "Ice", "Charyu", "Sophia", 
            "æ›¸ç¿¹", "Chilam", "Momo", "æ˜æš‰", "æ±æ¦®", "å®¶æ¿‚", "å‹‡", 
            "Pata"
        ];
        
        let PERSON_NAMES = [...INITIAL_NAMES];

        const MAX_SET_COST = 5.00; // ä¸»é¤åŠ å¤§è²»ç”¨
        const CORN_CUP_PRICE = 15.00; // ç²’ç²’ç²Ÿç±³æ¯æ¨™æº–åƒ¹å€¼ï¼ˆèˆ‡ä¸­è–¯æ¢æ¨™æº–åƒ¹å€¼ç›¸åŒï¼‰

        const menuData = {
            'æœŸé–“é™å®š': [ 
                { name: 'è è˜¿è’œè¾£è›‹é»ƒé†¬è„†çˆ†é›è…¿é£½', type: 'Burger', aLaCarte: 32.50, set: 48.00 }, 
                { name: 'è’œè¾£è›‹é»ƒé†¬è„†çˆ†é›è…¿é£½', type: 'Burger', aLaCarte: 29.50, set: 39.00 },
                { name: 'éº¥ç‚¸é› (åŸå‘³) (1ä»¶)', type: 'Chicken_Side', aLaCarte: 22.50, set: null }, 
                { name: 'éº¥ç‚¸é› (åŸå‘³) (2ä»¶)', type: 'Chicken_Set_Main', aLaCarte: 39.50, set: 35.00 },
                { name: 'èœœç³–BBQéº¥ç‚¸é› (1ä»¶)', type: 'Chicken_Side', aLaCarte: 23.50, set: null }, 
                { name: 'èœœç³–BBQéº¥ç‚¸é› (2ä»¶)', type: 'Chicken_Set_Main', aLaCarte: 41.50, set: 39.00 },
                { name: 'éº¥ç‚¸é›(åŸå‘³)åˆ†äº«æ¡¶(6ä»¶)', type: 'Chicken_Set_Main', aLaCarte: 116.50, set: 136.50 },
                { name: 'èœœç³–BBQéº¥ç‚¸é›åˆ†äº«æ¡¶(6ä»¶)', type: 'Chicken_Set_Main', aLaCarte: 122.50, set: 142.50 },
                { name: 'åŸå‘³åŠèœœç³–BBQéº¥ç‚¸é›åˆ†äº«æ¡¶(ç¸½å…±6ä»¶)', type: 'Chicken_Set_Main', aLaCarte: 122.50, set: 142.50 }
            ],
            'The Signature Collection': [ 
                { name: 'DoubleèŠå£«å®‰æ ¼æ–¯', type: 'Burger', aLaCarte: 48.50, set: 59.50 }, 
                { name: 'è˜‘è‡å®‰æ ¼æ–¯', type: 'Burger', aLaCarte: 40.00, set: 54.00 },     
                { name: 'èŠå£«å®‰æ ¼æ–¯', type: 'Burger', aLaCarte: 35.50, set: 49.00 }      
            ],
            'BURGERS': [
                { name: 'å·¨ç„¡éœ¸Â®', type: 'Burger', aLaCarte: 25.50, set: 47.50 },
                { name: 'é›™å±¤èŠå£«å­–å ¡â„¢', type: 'Burger', aLaCarte: 24.00, set: 44.00 },
                { name: 'è„†è¾£é›è…¿é£½', type: 'Burger', aLaCarte: 26.50, set: 47.00 },
                { name: 'è„†çˆ†é›è…¿é£½', type: 'Burger', aLaCarte: 29.50, set: 39.00 },
                { name: 'æ¿ç‡’é›è…¿é£½', type: 'Burger', aLaCarte: 28.00, set: 47.50 },
                { name: 'èŠå£«æ¼¢å ¡é£½', type: 'Burger', aLaCarte: 17.00, set: null },
                { name: 'æ¼¢å ¡é£½', type: 'Burger', aLaCarte: 15.00, set: null },
                { name: 'éº¥é¦™é›Â®', type: 'Burger', aLaCarte: 15.50, set: null },
                { name: 'é­šæŸ³é£½', type: 'Burger', aLaCarte: 14.00, set: 42.50 }, 
                { name: 'è±¬æŸ³è›‹æ¼¢å ¡', type: 'Muffin', aLaCarte: 22.50, set: 30.00 },
                { name: 'è±¬æŸ³æ¼¢å ¡', type: 'Muffin', aLaCarte: 15.50, set: 40.50 }, 
                { name: 'éº¥èŠè›‹é£½', type: 'Muffin', aLaCarte: 17.00, set: null }
            ],
            'CHICKEN': [ 
                { name: 'éº¥æ¨‚é›Â® (6ä»¶)', type: 'Chicken_Set_Main', aLaCarte: 24.00, set: 29.00 }, 
                { name: 'éº¥æ¨‚é›Â® (9ä»¶)', type: 'Chicken_Set_Main', aLaCarte: 29.00, set: 47.00 }, 
                { name: 'è„†é¦™é›ç¿¼ (2ä»¶)', type: 'Sides', aLaCarte: 15.00, set: null }, // é…é¤ (Side Item)
                { name: 'è„†é¦™é›ç¿¼ (4ä»¶)', type: 'Chicken_Set_Main', aLaCarte: 27.00, set: 47.00 }, 
                { name: 'è„†é¦™é›ç¿¼åˆ†äº«æ¡¶ (16ä»¶)', type: 'Chicken_Set_Main', aLaCarte: 103.00, set: 134.00 } 
            ],
            'SALAD': [
                { name: 'å‡±æ’’æ²™å¾‹', type: 'Salad', aLaCarte: 34.50, set: 47.50 }, 
                { name: 'å‡±æ’’æ²™å¾‹é†¬', type: 'Dessert', aLaCarte: 4.00, set: null, code: 'Caesar_Sauce' },
                { name: 'ç„™ç…èŠéº»é†¬', type: 'Dessert', aLaCarte: 4.00, set: null, code: 'Sesame_Sauce' },
                { name: 'é»‘é†‹èª¿å‘³æ±', type: 'Dessert', aLaCarte: 4.00, set: null, code: 'Balsamic_Sauce' }
            ],
            'SIDES & DESSERTS': [
                { name: 'æœ±å¤åŠ›è‚‰æ¡‚è¿·ä½ è„†æ¢', type: 'Dessert', aLaCarte: 18.00, set: null, code: 'Choc_Cinn_Stick' }, 
                { name: 'è˜‹æœæ‰¹', type: 'Dessert', aLaCarte: 11.00, set: null, code: 'Apple_Pie' }
            ],
            'HAPPY MEALS': [
                 { name: 'é­šæŸ³é£½', type: 'HappyMeal', aLaCarte: null, set: 36.50 },
                 { name: 'éº¥æ¨‚é›Â® (4ä»¶)', type: 'HappyMeal', aLaCarte: null, set: 34.50 },
                 { name: 'èŠå£«æ¼¢å ¡é£½', type: 'HappyMeal', aLaCarte: null, set: 28.50 },
                 { name: 'éº¥èŠè›‹é£½', type: 'HappyMeal', aLaCarte: null, set: 28.50 }
            ],
            'DRINKS': [ 
                // å†·é£² (COLD DRINKS)
                { name: 'å¯å£å¯æ¨‚Â®æ±½æ°´', type: 'Drink', aLaCarte: 17.00, set: null, subCategory: 'COLD DRINKS', code: 'Coke' },
                { name: 'é›ªç¢§Â®æª¸æª¬é’æª¸å‘³æ±½æ°´', type: 'Drink', aLaCarte: 17.00, set: null, subCategory: 'COLD DRINKS', code: 'Sprite' },
                { name: 'èŠ¬é”Â®æ©™å‘³æ±½æ°´', type: 'Drink', aLaCarte: 17.00, set: null, subCategory: 'COLD DRINKS', code: 'Fanta' },
                { name: 'ç„¡ç³–å¯å£å¯æ¨‚Â®', type: 'Drink', aLaCarte: 17.00, set: null, subCategory: 'COLD DRINKS', code: 'Coke0' }, 
                { name: 'å‡æ–°é®®æª¸æª¬èŒ¶', type: 'Drink', aLaCarte: 21.50, set: null, subCategory: 'COLD DRINKS', code: 'C0T' }, 
                { name: 'å‡æ¸¯å¼å¥¶èŒ¶', type: 'Drink', aLaCarte: 21.50, set: null, subCategory: 'COLD DRINKS', code: 'CMT' }, 
                { name: 'ç™½æ¡ƒæ¢³æ‰“', type: 'Drink', aLaCarte: 23.50, set: null, subCategory: 'COLD DRINKS', code: 'Peach' }, 
                { name: 'ç¾ç²’æœÂ®è˜‹æœæ±', type: 'Drink', aLaCarte: 20.00, set: null, subCategory: 'COLD DRINKS', code: 'Apple' },
                { name: 'ç¾ç²’æœÂ®æ©™æ±', type: 'Drink', aLaCarte: 17.00, set: null, subCategory: 'COLD DRINKS', code: 'Orange' }, 
                { name: 'é«˜éˆ£ä½è„‚ç‰›å¥¶é£²å“', type: 'Drink', aLaCarte: 19.00, set: null, subCategory: 'COLD DRINKS', code: 'Milk' },
                { name: 'å£«å¤šå•¤æ¢¨å¥¶æ˜”', type: 'Drink', aLaCarte: 18.00, set: null, subCategory: 'COLD DRINKS', code: 'SMilkS' },
                { name: 'å‘å‘¢æ‹¿å¥¶æ˜”', type: 'Drink', aLaCarte: 18.00, set: null, subCategory: 'COLD DRINKS', code: 'VMilkS' },

                // ç†±é£² (HOT DRINKS)
                { name: 'ç†±æ¸¯å¼å¥¶èŒ¶', type: 'Drink', aLaCarte: 18.50, set: null, subCategory: 'HOT DRINKS', code: 'MT' }, 
                { name: 'ç†±æœ±å¤åŠ›', type: 'Drink', aLaCarte: 18.50, set: null, subCategory: 'HOT DRINKS', code: 'HotC' },
                { name: 'ç†±æ–°é®®æª¸æª¬èŒ¶', type: 'Drink', aLaCarte: 18.50, set: null, subCategory: 'HOT DRINKS', code: '0T' }, 
                { name: 'ç†±æ–°é®®æª¸æª¬æ°´', type: 'Drink', aLaCarte: 18.50, set: null, subCategory: 'HOT DRINKS', code: '0W' }, 
                
                // å’–å•¡ - å†° (ICED COFFEE)
                { name: 'å‡å³ç£¨é»‘å’–å•¡', type: 'Drink', aLaCarte: 19.00, set: null, subCategory: 'ICED COFFEE', code: 'ICB' }, 
                { name: 'å‡å³ç£¨é®®å¥¶å’–å•¡', type: 'Drink', aLaCarte: 19.00, set: null, subCategory: 'ICED COFFEE', code: 'ICL' }, 
                { name: 'åšæ¤°å¥¶éµ', type: 'Drink', aLaCarte: 36.00, set: null, subCategory: 'ICED COFFEE', code: 'ICCT' }, 
                { name: 'å‡å³ç£¨ç™½å’–å•¡', type: 'Drink', aLaCarte: 34.50, set: null, subCategory: 'ICED COFFEE', code: 'ICF' }, 
                
                // å’–å•¡ - ç†± (HOT COFFEE)
                { name: 'ç†±æœ±å¤åŠ›å’–å•¡', type: 'Drink', aLaCarte: 16.00, set: null, subCategory: 'HOT COFFEE', code: 'HC' }, 
                { name: 'å³ç£¨é»‘å’–å•¡', type: 'Drink', aLaCarte: 16.00, set: null, subCategory: 'HOT COFFEE', code: 'HB' }, 
                { name: 'å³ç£¨é®®å¥¶å’–å•¡', type: 'Drink', aLaCarte: 16.00, set: null, subCategory: 'HOT COFFEE', code: 'HL' }, 
                { name: 'æ¤°é¦™é®®å¥¶å’–å•¡', type: 'Drink', aLaCarte: 25.00, set: null, subCategory: 'HOT COFFEE', code: 'HCL' }, 
                { name: 'å³ç£¨ç™½å’–å•¡', type: 'Drink', aLaCarte: 24.50, set: null, subCategory: 'HOT COFFEE', code: 'HF' } 
            ]
        };

        const STANDARD_DRINK_VALUE = 10.00; 
        const STANDARD_SIDE_VALUE = 15.00; // ä¸­è–¯æ¢ M (Fries_M) çš„æ¨™æº–åƒ¹å€¼
        const LARGE_SIDE_VALUE = 20.00; // å¤§è–¯æ¢ L (Fries_L) çš„æ¨™æº–åƒ¹å€¼

        const drinkPrices = {
            // Free standard drinks (å‡ç´šè²»ç”¨ HK$0.00)
            'Coke': 17.00, 'Sprite': 17.00, 'Fanta': 17.00, 'Coke0': 17.00, 
            'HotC': 18.50, '0T': 18.50, '0W': 18.50, 
            
            // Standard drinks that cost more
            'C0T': 21.50, 'CMT': 21.50, 'Peach': 23.50, 'Apple': 20.00, 'Orange': 17.00, 
            'Milk': 19.00, 'SMilkS': 18.00, 'VMilkS': 18.00,
            'MT': 18.50, 

            'ICB': 19.00, 'ICL': 19.00, 'ICCT': 36.00, 'ICF': 34.50,
            'HC': 16.00, 'HB': 16.00, 'HL': 16.00, 'HCL': 25.00, 'HF': 24.50
        };

        const sidePrices = {
            'Fries_M': STANDARD_SIDE_VALUE, 
            'Fries_L': LARGE_SIDE_VALUE, // å¤§è–¯æ¢
            'Corn_Cup': CORN_CUP_PRICE, // ç²’ç²’ç²Ÿç±³æ¯
            'Choc_Cinn_Stick': 18.00, 
            'Apple_Pie': 11.00, 
            'Milo_Sundae': 12.50, 
            'Cone': 8.50, 
            'Straw_Sundae': 12.00,
            'Caesar_Sauce': 4.00,
            'Sesame_Sauce': 4.00,
            'Balsamic_Sauce': 4.00,
            // éº¥ç‚¸é› (1ä»¶) è¦–ç‚ºé…é¤/åŠ è³¼
            'Original_Chicken_1pc': 22.50, 
            'BBQ_Chicken_1pc': 23.50,
            'Crispy_Wings_2pc': 15.00 // è„†é¦™é›ç¿¼ (2ä»¶)
        };
        
        // å°‡èœå–®æ•¸æ“šä¸­çš„é…é¤/å–®é»é›è‚‰ç”¢å“ä»£ç¢¼åŒ–ï¼Œæ–¹ä¾¿æŸ¥æ‰¾
        menuData['æœŸé–“é™å®š'].forEach(item => {
            if (item.name === 'éº¥ç‚¸é› (åŸå‘³) (1ä»¶)') item.code = 'Original_Chicken_1pc';
            if (item.name === 'èœœç³–BBQéº¥ç‚¸é› (1ä»¶)') item.code = 'BBQ_Chicken_1pc';
        });
        menuData['CHICKEN'].forEach(item => {
            if (item.name === 'è„†é¦™é›ç¿¼ (2ä»¶)') item.code = 'Crispy_Wings_2pc';
        });


        let orders = [];

        function createNewOrder(personName) {
            return {
                personName: personName, 
                mainItem: { name: 'æœªé¸æ“‡', price: 0, isSet: false, isMaxSet: false }, 
                sideItem: { name: 'ç„¡', price: 0, code: '' }, 
                drink: { name: 'ç„¡', price: 0, code: '' },   
                extraSides: [] 
            };
        }

        function initApp() {
            loadOrdersFromStorage();
            
            document.getElementById('add-order-btn').addEventListener('click', addNewPerson);
            
            renderPersonSelect();
            renderMenu();
            renderOrders();
        }

        function renderPersonSelect() {
            const select = document.getElementById('person-select');
            select.innerHTML = '';
            
            orders.forEach((order, index) => {
                const option = document.createElement('option');
                option.value = index; 
                option.textContent = order.personName; 
                select.appendChild(option);
            });
        }
        
        function addNewPerson() {
            const customName = prompt("è«‹è¼¸å…¥æ–°è¨‚é¤äººçš„åå­—ï¼š");
            
            if (customName && customName.trim() !== '') {
                const newName = customName.trim();
                const newOrderIndex = orders.length;
                
                orders.push(createNewOrder(newName));
                
                renderPersonSelect();
                
                document.getElementById('person-select').value = newOrderIndex;
                
                saveOrdersToStorage();
                renderOrders();
            } else if (customName !== null) {
                alert("åå­—ä¸èƒ½ç‚ºç©ºï¼Œæ–°å¢è¨‚é¤äººæ“ä½œå–æ¶ˆã€‚");
            }
        }

        // ä¸»èœå–®æ”¶åˆ/å±•é–‹
        function toggleCategory(titleElement) {
            const contentElement = titleElement.nextElementSibling;
            const isExpanded = contentElement.classList.contains('expanded');
            
            document.querySelectorAll('.menu-category-content.expanded').forEach(openContent => {
                if (openContent !== contentElement) { 
                    openContent.style.maxHeight = openContent.scrollHeight + "px"; 
                    requestAnimationFrame(() => {
                        openContent.style.maxHeight = '0';
                    });
                    openContent.classList.remove('expanded');
                    openContent.previousElementSibling.classList.remove('expanded');
                }
            });

            if (!isExpanded) {
                contentElement.classList.add('expanded');
                titleElement.classList.add('expanded');
                contentElement.style.maxHeight = contentElement.scrollHeight + "px";
            } else {
                contentElement.style.maxHeight = contentElement.scrollHeight + "px";
                requestAnimationFrame(() => {
                    contentElement.style.maxHeight = '0';
                });
                contentElement.classList.remove('expanded');
                titleElement.classList.remove('expanded');
            }
        }
        
        // å­èœå–®æ”¶åˆ/å±•é–‹
        function toggleSubCategory(titleElement) {
            const contentElement = titleElement.nextElementSibling;
            const isExpanded = contentElement.classList.contains('expanded');
            
            if (!isExpanded) {
                contentElement.classList.add('expanded');
                titleElement.classList.add('expanded');
                contentElement.style.maxHeight = contentElement.scrollHeight + "px";
            } else {
                contentElement.style.maxHeight = contentElement.scrollHeight + "px";
                requestAnimationFrame(() => {
                    contentElement.style.maxHeight = '0';
                });
                contentElement.classList.remove('expanded');
                titleElement.classList.remove('expanded');
            }

            let parentContent = titleElement.closest('.menu-category-content');
            if (parentContent) {
                parentContent.style.maxHeight = parentContent.scrollHeight + "px";
            }
        }
        
        function renderMenu() {
            const menuContentDiv = document.getElementById('menu-content');
            let html = '';
            
            for (const category in menuData) {
                let displayCategory = category.replace(/_/g, ' ');
                
                // V3.29: å¦‚æœåˆ†é¡ä¸‹æ²’æœ‰ä»»ä½•é …ç›®ï¼Œå‰‡è·³é
                if (menuData[category].length === 0) continue; 
                
                html += `<div class="menu-category-container">`;
                html += `<div class="menu-category-title" onclick="toggleCategory(this)">${displayCategory.toUpperCase()}</div>`;
                html += `<div class="menu-category-content">`;
                
                if (category === 'DRINKS') {
                    
                    const drinksMap = menuData[category].reduce((acc, item) => {
                        if (!acc[item.subCategory]) acc[item.subCategory] = [];
                        acc[item.subCategory].push(item);
                        return acc;
                    }, {});

                    for (const subCat in drinksMap) {
                        const displayName = subCat.toUpperCase().replace('COFFEE', 'å’–å•¡');
                        
                        html += `<div class="menu-sub-toggle" onclick="toggleSubCategory(this)">${displayName}</div>`;
                        html += `<div class="menu-sub-content">`;
                        
                        drinksMap[subCat].forEach(item => {
                            let itemHtml = `<strong>${item.name}`;
                            if (item.code) {
                                itemHtml += `<span class="item-code">(${item.code})</span>`;
                            }
                            itemHtml += `</strong>`;

                            if (item.aLaCarte !== null) {
                                itemHtml += `<small class="price-red-bold">å–®é»: HK$${item.aLaCarte.toFixed(2)}</small>`; 
                            }
                            
                            html += `
                                <div class="menu-item single-only" 
                                    onclick="showSelectionModal('${item.name}', ${item.aLaCarte}, ${item.set}, '${item.type}', '${item.code || ''}')">
                                    ${itemHtml}
                                </div>
                            `;
                        });
                        
                        html += `</div>`; 
                    }

                } else {
                    
                    menuData[category].forEach(item => {
                        const isMainItemCategory = (item.type === 'Burger' || item.type === 'Chicken_Set_Main' || item.type === 'Salad' || item.type === 'Muffin');
                        const isSetAvailable = item.set !== null && item.set !== 'null';
                        
                        const isPriceRedCategory = (item.type === 'Burger' || item.type === 'Chicken_Set_Main' || item.type === 'Salad' || item.type === 'Muffin' || item.type === 'Sides' || item.type === 'Dessert' || item.type === 'HappyMeal' || item.type === 'Chicken_Side' || item.type === 'Side_Alternative'); 
                        
                        const priceClass = isPriceRedCategory ? 'price-red-bold' : '';
                        
                        // æ§‹å»ºåƒ¹æ ¼é¡¯ç¤º
                        let priceDisplay = '';
                        if (item.aLaCarte !== null) {
                            priceDisplay += `å–®é»: HK$${item.aLaCarte.toFixed(2)}`;
                        }
                        
                        if (isMainItemCategory && isSetAvailable) {
                            if (priceDisplay !== '') priceDisplay += ' | ';
                            priceDisplay += `å¥—é¤: HK$${item.set.toFixed(2)} (åŠ å¤§: HK$${(item.set + MAX_SET_COST).toFixed(2)})`;
                        } else if (item.set !== null) {
                            if (priceDisplay !== '') priceDisplay += ' | ';
                            priceDisplay += `å¥—é¤: HK$${item.set.toFixed(2)}`;
                        }

                        let itemHtml = `<strong>${item.name}`;
                        if (item.code) {
                            itemHtml += `<span class="item-code">(${item.code})</span>`;
                        }
                        itemHtml += `</strong>`;

                        if (priceDisplay !== '') {
                             itemHtml += `<small class="${priceClass}">${priceDisplay}</small>`;
                        } else if (item.set === null && item.aLaCarte === null) {
                             itemHtml += `<small>N/A</small>`;
                        }
                        
                        html += `
                            <div class="menu-item" 
                                onclick="showSelectionModal('${item.name}', ${item.aLaCarte}, ${item.set}, '${item.type}', '${item.code || ''}')">
                                ${itemHtml}
                            </div>
                        `;
                    });
                }
                
                html += `</div></div>`; 
            }

            menuContentDiv.innerHTML = html;
        }

        function renderOrders() {
            const container = document.getElementById('orders-container');
            let html = '<table><tr><th>#</th><th>Name</th><th>ä¸»é¤(å¥—é¤/å–®é»/åŠ å¤§)</th><th>é…é¤ (å‡ç´š/åŠ è³¼)</th><th>é£²å“ (å‡ç´š/åŠ è³¼)</th><th>Total</th><th>æ“ä½œ</th></tr>';

            orders.forEach((order, index) => {
                
                let extraSidesTotal = order.extraSides.reduce((sum, item) => sum + item.price, 0);
                const total = order.mainItem.price + order.sideItem.price + order.drink.price + extraSidesTotal;
                
                const personName = order.personName || 'æœªçŸ¥'; 
                
                let mainType = order.mainItem.isMaxSet ? 'MaxSet' : 
                                 (order.mainItem.isSet ? 'Set' : 
                                 (order.mainItem.name === 'æœªé¸æ“‡' ? '' : 'A'));
                
                let mainItemName = order.mainItem.name;
                let drinkItemName = order.drink.name;
                let drinkItemPrice = order.drink.price;
                
                // --- æ¸²æŸ“ é…é¤ (sideItem + extraSides) ---
                
                let sideItemDisplay = '';
                let sideItemPriceDisplay = 0.00; 
                
                const isMainOrderEmpty = (order.mainItem.name === 'æœªé¸æ“‡' || order.mainItem.name === 'ç„¡');
                
                // 1. å¥—é¤/åŠ å¤§å¥—é¤çš„æ¨™æº–/æ›¿æ›é…é¤
                if (order.mainItem.isSet || order.mainItem.isMaxSet) {
                    
                    // æª¢æŸ¥æ˜¯å¦ç‚ºæ¨™æº–/æ›¿æ›é…é¤ (Fries_M/L or Corn_Cup)
                    if (order.sideItem.name !== 'ç„¡') {
                        sideItemDisplay += order.sideItem.name;
                        sideItemPriceDisplay += order.sideItem.price; // å‡ç´š/æ›¿æ›è²»ç”¨ (é€šå¸¸ç‚º 0)
                    }
                } 
                
                // 2. åŠ è³¼/å–®é»é…é¤ (extraSides)
                if (order.extraSides.length > 0) {
                    const extraNames = order.extraSides.map(item => item.name).join(' + ');
                    extraSidesTotal = order.extraSides.reduce((sum, item) => sum + item.price, 0);
                    
                    if (sideItemDisplay !== '') {
                        sideItemDisplay += ' + ';
                    } 
                    sideItemDisplay += extraNames;
                    sideItemPriceDisplay += extraSidesTotal;
                }

                // è™•ç†é¡¯ç¤ºæ–‡å­—èˆ‡åƒ¹æ ¼
                if (isMainOrderEmpty) {
                    if (sideItemDisplay !== '') {
                        sideItemDisplay = `${sideItemDisplay} <span style="color: var(--mcd-red); font-weight: bold;">(HK$ ${sideItemPriceDisplay.toFixed(2)})</span>`;
                    } else {
                        sideItemDisplay = `ç„¡ <span style="color: #666; font-weight: bold;">(0.00)</span>`;
                    }
                } else if (order.mainItem.isSet || order.mainItem.isMaxSet) {
                    // å¥—é¤æˆ–åŠ å¤§å¥—é¤
                    
                    if (sideItemDisplay !== '') {
                        const isFree = order.sideItem.price === 0 && order.extraSides.length === 0;
                        const prefix = (sideItemPriceDisplay > 0) ? '+' : '';
                        
                        sideItemDisplay = `${sideItemDisplay} <span style="color: ${sideItemPriceDisplay !== 0 ? 'var(--mcd-red)' : '#666'}; font-weight: bold;">(${isFree ? 'å…è²»' : prefix + sideItemPriceDisplay.toFixed(2)})</span>`;
                    } else {
                        sideItemDisplay = `ç„¡ <span style="color: #666; font-weight: bold;">(0.00)</span>`;
                    }
                } else {
                    // å–®é»ä¸»é¤
                    if (sideItemDisplay !== '') {
                        sideItemDisplay = `${sideItemDisplay} <span style="color: var(--mcd-red); font-weight: bold;">(HK$ ${sideItemPriceDisplay.toFixed(2)})</span>`;
                    } else {
                        sideItemDisplay = `ç„¡ <span style="color: #666; font-weight: bold;">(0.00)</span>`;
                    }
                }
                
                // --- æ¸²æŸ“ é£²å“ (drinkItem) ---
                
                let drinkItemDisplay;
                
                if (isMainOrderEmpty) {
                    if (drinkItemPrice > 0) {
                        drinkItemDisplay = `
                            ${drinkItemName} 
                            <span style="color: var(--mcd-red); font-weight: bold;">
                                (HK$ ${drinkItemPrice.toFixed(2)})
                            </span>
                        `;
                    } else {
                        drinkItemDisplay = `ç„¡ <span style="color: #666; font-weight: bold;">(0.00)</span>`;
                    }
                } else if (order.mainItem.isSet || order.mainItem.isMaxSet) {
                    // å¥—é¤/åŠ å¤§å¥—é¤
                    const prefix = (drinkItemPrice > 0) ? '+' : '';
                     drinkItemDisplay = `
                        ${drinkItemName} 
                        <span style="color: ${drinkItemPrice !== 0 ? 'var(--mcd-red)' : '#666'}; font-weight: bold;">
                            (${drinkItemPrice === 0 ? 'å…è²»' : prefix + drinkItemPrice.toFixed(2)})
                        </span>
                    `;
                } else {
                    // å–®é»ä¸»é¤
                    if (drinkItemPrice > 0) {
                         drinkItemDisplay = `
                            ${drinkItemName} 
                            <span style="color: var(--mcd-red); font-weight: bold;">
                                (HK$ ${drinkItemPrice.toFixed(2)})
                            </span>
                        `;
                    } else {
                        drinkItemDisplay = `ç„¡ <span style="color: #666; font-weight: bold;">(0.00)</span>`;
                    }
                }
                
                
                html += `
                    <tr id="row-${index}">
                        <td>${index + 1}</td>
                        <td style="font-weight: bold;">${personName}</td>
                        <td>${mainItemName} <span style="font-weight: bold;">(${mainType})</span></td>
                        <td>${sideItemDisplay}</td>
                        <td>${drinkItemDisplay}</td>
                        <td class="subtotal" style="font-weight: bold;">HK$ ${total.toFixed(2)}</td>
                        <td>
                            <button onclick="clearOrder(${index})">æ¸…ç©º</button>
                            ${index >= INITIAL_NAMES.length ? `<button onclick="deleteOrder(${index})" style="background-color: #f44336; color: white; margin-left: 5px;">åˆªé™¤</button>` : ''}
                        </td>
                    </tr>
                `;
            });
            html += '</table>';
            container.innerHTML = html;
            calculateTotal();
            saveOrdersToStorage(); 
        }

        function showSelectionModal(name, aLaCartePrice, setPrice, itemType, itemCode) {
            const personSelect = document.getElementById('person-select');
            const index = parseInt(personSelect.value); 
            
            if (isNaN(index) || index < 0 || index >= orders.length) return alert("è«‹å…ˆé¸æ“‡è¦é»é¤çš„ç”¨æˆ¶ã€‚");
            
            const currentOrder = orders[index];
            const personName = currentOrder.personName || 'æœªçŸ¥';

            const isSetAvailable = setPrice !== null && setPrice !== 'null';
            
            const isMainItemCategory = (itemType === 'Burger' || itemType === 'Chicken_Set_Main' || itemType === 'Salad' || itemType === 'Muffin');
            
            // --- è™•ç†éä¸»é¤é …ç›® (é…é¤ã€ç”œå“ã€é£²å“) ---
            if (!isMainItemCategory && itemType !== 'HappyMeal') {
                if (aLaCartePrice === null) return alert("æ­¤é …ç›®åƒ¹æ ¼è³‡æ–™ä¸å®Œæ•´ï¼Œç„¡æ³•é»é¤ã€‚");

                let confirmMessage = `æ‚¨é¸æ“‡äº† ${name} (ä»£ç¢¼: ${itemCode || 'N/A'}, HK$${aLaCartePrice.toFixed(2)})ï¼Œç‚ºã€${personName}ã€‘é»é¤ã€‚`;
                
                const isMainOrderEmpty = (currentOrder.mainItem.name === 'æœªé¸æ“‡');

                if (itemType === 'Drink') {
                    confirmMessage += `\n\n[ç¢ºå®š/OK]ï¼šå°‡å…¶è¨­å®šç‚ºã€å–®é»é£²å“/åŠ è³¼ã€‘(åƒ¹æ ¼ HK$${aLaCartePrice.toFixed(2)})`;
                    if (confirm(confirmMessage)) {
                        const newDrinkName = currentOrder.drink.name === 'ç„¡' ? name : `${currentOrder.drink.name} + ${name}`;
                        currentOrder.drink = { name: newDrinkName, price: currentOrder.drink.price + aLaCartePrice, code: '' };
                         
                        if (isMainOrderEmpty) currentOrder.mainItem = { name: 'ç„¡', price: 0, isSet: false, isMaxSet: false }; 
                    } else {
                        return;
                    }
                } else if (itemType === 'Dessert' || itemType === 'Sides' || itemType === 'Chicken_Side' || itemType === 'Side_Alternative') {
                    // V3.29: Side_Alternative åªæœ‰ Corn_Cupï¼Œä½†å®ƒåœ¨èœå–®ä¸­å·²è¢«ç§»é™¤ï¼Œæ‰€ä»¥é€™æ®µåªè™•ç† Desserts/Sides/Chicken_Side
                    
                    confirmMessage += `\n\n[ç¢ºå®š/OK]ï¼šå°‡å…¶è¨­å®šç‚ºã€å–®é»åŠ è³¼/é…é¤ã€‘(åƒ¹æ ¼ HK$${aLaCartePrice.toFixed(2)})`;
                    
                    if (confirm(confirmMessage)) {
                         currentOrder.extraSides.push({ name: name, price: aLaCartePrice, code: itemCode || '' });
                        
                         if (isMainOrderEmpty) currentOrder.mainItem = { name: 'ç„¡', price: 0, isSet: false, isMaxSet: false };
                    } else {
                        return;
                    }
                }
            } 
            // --- è™•ç† Happy Meals ---
            else if (itemType === 'HappyMeal' && setPrice !== null) {
                if (confirm(`ç¢ºå®šå°‡ã€Happy Meal: ${name}ã€‘(HK$${setPrice.toFixed(2)}) è¨­ç‚ºã€${personName}ã€‘çš„å¥—é¤å—ï¼Ÿé€™å°‡è¦†è“‹ç¾æœ‰è¨‚å–®ã€‚`)) {
                    currentOrder.mainItem = { name: `Happy Meal: ${name}`, price: setPrice, isSet: true, isMaxSet: false };
                    currentOrder.drink = { name: 'å¯å£å¯æ¨‚Â®æ±½æ°´', price: 0, code: 'Coke' }; 
                    currentOrder.sideItem = { name: 'æ¨™æº–è–¯æ¢ M', price: 0, code: 'Fries_M' }; 
                    currentOrder.extraSides = [];
                }
            } 
            // --- è™•ç†ä¸»é¤ (Burger/Chicken_Set_Main/Salad/Muffin) ---
            else if (isMainItemCategory) {
                
                let choice; 
                
                if (!isSetAvailable) {
                    if (confirm(`æ‚¨é¸æ“‡äº† ${name}ï¼Œç‚ºã€${personName}ã€‘é»é¤ã€‚\n\næ­¤é …ç›®åªæœ‰å–®é»åƒ¹æ ¼: HK$${aLaCartePrice.toFixed(2)}\n\n[ç¢ºå®š/OK] = å–®é» (HK$${aLaCartePrice.toFixed(2)})`)) {
                        choice = 'A';
                    } else {
                        return; 
                    }
                } else {
                    const message = `
æ‚¨é¸æ“‡äº† ${name}ï¼Œç‚ºã€${personName}ã€‘é»é¤ã€‚\n
è«‹é¸æ“‡ï¼š\n
1. [ç¢ºå®š/OK] = å¥—é¤ (Set): HK$${setPrice.toFixed(2)} (ä¸­è–¯æ¢/ç²Ÿç±³æ¯)\n
2. [å–æ¶ˆ/Cancel] ä¸¦æ–¼ä¸‹ä¸€å€‹æç¤ºä¸­é¸ [ç¢ºå®š/OK] = åŠ å¤§å¥—é¤ (MaxSet): HK$${(setPrice + MAX_SET_COST).toFixed(2)} (å¤§è–¯æ¢/ç²Ÿç±³æ¯)\n
3. [å–æ¶ˆ/Cancel] ä¸¦æ–¼ä¸‹ä¸€å€‹æç¤ºä¸­é¸ [å–æ¶ˆ/Cancel] = å–®é» (A): HK$${aLaCartePrice.toFixed(2)}
                    `;
                    
                    if (confirm(message)) {
                        choice = 'Set';
                    } else {
                         // ç¬¬äºŒæ¬¡ç¢ºèªï¼šåŠ å¤§å¥—é¤ vs å–®é»
                         const maxSetMsg = `
æ‚¨é¸æ“‡äº† ${name}ï¼Œç‚ºã€${personName}ã€‘é»é¤ã€‚\n
è«‹ç¢ºèªï¼š\n
[ç¢ºå®š/OK] = åŠ å¤§å¥—é¤ (MaxSet): HK$${(setPrice + MAX_SET_COST).toFixed(2)} (å¤§è–¯æ¢/ç²Ÿç±³æ¯)\n
[å–æ¶ˆ/Cancel] = å–®é» (A): HK$${aLaCartePrice.toFixed(2)}
                        `;
                        choice = confirm(maxSetMsg) ? 'MaxSet' : 'A';
                    }
                }
                
                let finalMainPrice;
                let isSet = false;
                let isMaxSet = false;

                if (choice === 'Set') {
                    finalMainPrice = setPrice;
                    isSet = true;
                } else if (choice === 'MaxSet') {
                    finalMainPrice = setPrice + MAX_SET_COST;
                    isMaxSet = true;
                } else {
                    finalMainPrice = aLaCartePrice;
                }

                // æ¸…ç©ºä¹‹å‰çš„é…é¤å’Œé£²å“ï¼Œå› ç‚ºé¸äº†æ–°çš„ä¸»é¤
                currentOrder.mainItem = { name: name, price: finalMainPrice, isSet: isSet, isMaxSet: isMaxSet };
                currentOrder.drink = { name: 'ç„¡', price: 0, code: '' }; 
                currentOrder.sideItem = { name: 'ç„¡', price: 0, code: '' }; 
                currentOrder.extraSides = [];
                
                if (isSet || isMaxSet) {
                    
                    const sideItemDefaultCode = isMaxSet ? 'Fries_L' : 'Fries_M';
                    const sideItemDefaultName = isMaxSet ? 'å¤§è–¯æ¢ L' : 'æ¨™æº–è–¯æ¢ M';
                    
                    // 1. è™•ç†é…é¤æ›¿æ›
                    let sideChoice;
                    const sideMessage = `
ã€${personName} çš„é…é¤æ›¿æ›ã€‘\n
å¥—é¤é è¨­: ${sideItemDefaultName} (å…è²»)\n
[ç¢ºå®š/OK] = ä¿æŒ ${sideItemDefaultName}\n
[å–æ¶ˆ/Cancel] = æ›¿æ›ç‚º ç²’ç²’ç²Ÿç±³æ¯ (Corn_Cup)
                    `;
                    sideChoice = confirm(sideMessage) ? sideItemDefaultCode : 'Corn_Cup';

                    // è¨­ç½®å¥—é¤æ¨™æº–/æ›¿æ›é…é¤
                    if (sideChoice === 'Corn_Cup') {
                        // Corn_Cup çš„æ¨™æº–åƒ¹å€¼èˆ‡ Fries_M ç›¸åŒï¼Œæ›¿æ›è²»ç”¨ç‚º 0
                        let sidePrice = CORN_CUP_PRICE;
                        let standardPrice = isMaxSet ? LARGE_SIDE_VALUE : STANDARD_SIDE_VALUE; 

                        // æ›¿æ›è²»ç”¨ï¼šCorn_Cup (15) - Fries_M (15) = 0 | Corn_Cup (15) - Fries_L (20) = -5 -> 0
                        let finalSideCost = 0.00; // çµ±ä¸€è¨­ç‚º 0
                        
                        currentOrder.sideItem = { name: 'ç²’ç²’ç²Ÿç±³æ¯', price: finalSideCost, code: 'Corn_Cup' }; 
                    } else {
                        // Fries_M/L
                        currentOrder.sideItem = { name: sideItemDefaultName, price: 0, code: sideItemDefaultCode }; 
                    }
                    
                    // 2. è™•ç†é£²å“å‡ç´š/åŠ è³¼ 
                    const drinkInput = prompt(`ã€${personName} çš„é£²å“å‡ç´š/åŠ è³¼ã€‘\næ¨™æº–é£²å“ï¼šå¯å£å¯æ¨‚Â®æ±½æ°´ (Coke) (å…è²»)\nè«‹è¼¸å…¥é£²å“ä»£ç¢¼ (å¯è¼¸å…¥å¤šå€‹ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼Œå¦‚: ICL C0T)ã€‚è‹¥ä¸å‡ç´š/åŠ è³¼ï¼Œè«‹ç•™ç©ºï¼š`);
                    
                    if (drinkInput && drinkInput.trim()) {
                        drinkInput.trim().split(/\s+/).forEach(code => {
                            processUpgrade(index, 'drink', code);
                        });
                    }

                    // 3. è™•ç†é…é¤å‡ç´š/åŠ è³¼
                    const sideInput = prompt(`ã€${personName} çš„é¡å¤–é…é¤åŠ è³¼/è–¯æ¢å‡ç´šã€‘\nè«‹è¼¸å…¥é…é¤ä»£ç¢¼ (å¯è¼¸å…¥å¤šå€‹ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼Œå¦‚: Fries_L Apple_Pie Crispy_Wings_2pc)ã€‚è‹¥ç„¡åŠ è³¼/å‡ç´šï¼Œè«‹ç•™ç©ºï¼š`);
                    
                    if (sideInput && sideInput.trim()) {
                        sideInput.trim().split(/\s+/).forEach(code => {
                            processUpgrade(index, 'side', code);
                        });
                    }
                }
            }
            
            renderOrders();
        }

        function processUpgrade(index, itemType, code) {
            if (!code || !code.trim()) {
                return; 
            }
            code = code.trim(); 
            
            const currentOrder = orders[index];
            const isSet = currentOrder.mainItem.isSet || currentOrder.mainItem.isMaxSet;

            let found = false;
            let finalCost = 0; // åˆå§‹åŒ– finalCost

            if (itemType === 'drink') {
                if (drinkPrices.hasOwnProperty(code)) {
                    
                    const itemData = menuData['DRINKS'].find(d => d.code === code);
                    const displayName = itemData ? itemData.name : code;
                    
                    if (isSet) {
                        // å¥—é¤/åŠ å¤§å¥—é¤ï¼šæ›¿æ›æ¨™æº–é£²å“ (åªéœ€è™•ç†å‡ç´šè²»ç”¨)
                        let standardValue = STANDARD_DRINK_VALUE;
                        finalCost = drinkPrices[code] - standardValue;
                        if (finalCost < 0) finalCost = 0;
                        
                        // æª¢æŸ¥ç•¶å‰æ˜¯å¦æœ‰é£²å“ï¼Œå¦‚æœæœ‰ï¼Œå‰‡å°‡æœ¬æ¬¡çš„å‡ç´šè²»ç”¨åŠ åˆ°ç•¶å‰çš„é£²å“ç¸½åƒ¹ä¸Š
                        if (currentOrder.drink.name === 'ç„¡' || currentOrder.drink.name === 'å¯å£å¯æ¨‚Â®æ±½æ°´') {
                            // ç¬¬ä¸€æ¬¡å‡ç´š (æ›¿æ›å¥—é¤é£²å“)
                            currentOrder.drink = { name: displayName, price: finalCost, code: code };
                        } else if (currentOrder.drink.price <= 0) {
                            // ä¿®æ­£ï¼šå¦‚æœé£²å“æ˜¯å…è²»çš„é»˜èªé£²å“ï¼Œç¬¬ä¸€æ¬¡å‡ç´š
                            currentOrder.drink = { name: displayName, price: finalCost, code: code };
                        } else {
                            // ä¹‹å¾Œçš„å‡ç´š/åŠ è³¼ (ç´¯åŠ å–®é»åƒ¹)
                            currentOrder.drink.name += ` + ${displayName}`;
                            currentOrder.drink.price += drinkPrices[code];
                        }

                    } else {
                       // å–®é»ä¸»é¤æˆ–ç„¡ä¸»é¤ï¼šè¦–ç‚ºåŠ è³¼ (ç´¯åŠ å–®é»åƒ¹æ ¼)
                       finalCost = drinkPrices[code];
                       const newDrinkName = currentOrder.drink.name === 'ç„¡' ? displayName : `${currentOrder.drink.name} + ${displayName}`;
                       currentOrder.drink = { name: newDrinkName, price: currentOrder.drink.price + finalCost, code: '' };
                    }
                    
                    found = true;
                }

            } else { 
                // é…é¤è™•ç†
                
                if (sidePrices.hasOwnProperty(code)) {
                    
                    finalCost = 0;
                    
                    if (code === 'Fries_M' || code === 'Fries_L' || code === 'Corn_Cup') {
                        
                        // è–¯æ¢/ç²Ÿç±³æ¯ å‡ç´š/æ›¿æ›é‚è¼¯ (åƒ…é™å¥—é¤)
                        if (isSet) {
                            
                            const currentDefaultSideCode = currentOrder.mainItem.isMaxSet ? 'Fries_L' : 'Fries_M';
                            const currentDefaultSideValue = currentOrder.mainItem.isMaxSet ? LARGE_SIDE_VALUE : STANDARD_SIDE_VALUE;
                            
                            let baseValue = currentDefaultSideValue; 
                            
                            // è™•ç†ç•¶å‰é…é¤æ˜¯ Corn_Cup çš„æƒ…æ³
                            if (currentOrder.sideItem.code === 'Corn_Cup') {
                                // å¦‚æœç›®å‰æ˜¯ Corn_Cup (å…è²»æ›¿æ›)ï¼Œç¾åœ¨è¦æ›æˆè–¯æ¢ï¼Œæ‡‰è©²æŒ‰ç…§åŸå¥—é¤è–¯æ¢çš„åƒ¹å€¼ä¾†è¨ˆç®—
                                baseValue = CORN_CUP_PRICE; 
                            }
                            
                            // æ›¿æ›å›é è¨­è–¯æ¢ (å…è²»)
                            if (code === currentDefaultSideCode && currentOrder.sideItem.code !== currentDefaultSideCode) {
                                currentOrder.sideItem = { name: currentDefaultSideCode === 'Fries_L' ? 'å¤§è–¯æ¢ L' : 'æ¨™æº–è–¯æ¢ M', price: 0, code: currentDefaultSideCode };
                                finalCost = 0;
                            } else if (code === 'Corn_Cup') {
                                // æ›¿æ›ç‚º Corn_Cup (å…è²»)
                                currentOrder.sideItem = { name: 'ç²’ç²’ç²Ÿç±³æ¯', price: 0.00, code: 'Corn_Cup' }; 
                                finalCost = 0;
                            } else if (code === 'Fries_M' || code === 'Fries_L') {
                                // Fries M/L ä¹‹é–“çš„å‡ç´š/é™ç´š
                                finalCost = sidePrices[code] - baseValue;
                                if (finalCost < 0) finalCost = 0; 
                            
                                const displayName = code === 'Fries_M' ? 'æ¨™æº–è–¯æ¢ M' : 'å¤§è–¯æ¢ L';
                                currentOrder.sideItem = { name: displayName, price: finalCost, code: code };
                            }
                            
                            found = true;
                        }
                        
                    } else {
                        // å…¶ä»–é…é¤ (ç”œå“, é†¬æ–™, è„†é¦™é›ç¿¼2ä»¶, éº¥ç‚¸é›1ä»¶) è¦–ç‚ºé¡å¤–åŠ è³¼ (extraSides)
                        const aLaCartePrice = sidePrices[code]; 
                        
                        let sideName = code.replace(/_/g, ' ');
                         if (code === 'Apple_Pie') sideName = 'è˜‹æœæ‰¹';
                         else if (code === 'Choc_Cinn_Stick') sideName = 'æœ±å¤åŠ›è‚‰æ¡‚è¿·ä½ è„†æ¢';
                         
                        
                        currentOrder.extraSides.push({ name: sideName, price: aLaCartePrice, code: code });
                        
                        // ç¢ºä¿å¥—é¤æœ‰é è¨­é…é¤ (å¦‚æœé‚„æ²’æœ‰è¢«æ›¿æ›/å‡ç´š)
                        if (isSet && currentOrder.sideItem.code === '') {
                            const defaultSideCode = currentOrder.mainItem.isMaxSet ? 'Fries_L' : 'Fries_M';
                            currentOrder.sideItem = { name: defaultSideCode === 'Fries_L' ? 'å¤§è–¯æ¢ L' : 'æ¨™æº–è–¯æ¢ M', price: 0.00, code: defaultSideCode };
                        }
                        found = true; 
                    }
                }
            }
            
            if (found) {
               console.log(`è™•ç†æˆåŠŸ: ${currentOrder.personName} çš„ ${itemType} è¨­å®šç‚º ${itemType === 'drink' ? currentOrder.drink.name : (currentOrder.sideItem.name || 'åŠ è³¼é …ç›®')}, è²»ç”¨: ${finalCost !== undefined ? finalCost.toFixed(2) : 'N/A'}`);
            } else if (code) { 
                // V3.28: ç§»é™¤é€™å€‹è­¦å ±ï¼Œé¿å…å¤šæ¬¡å½ˆå‡º
            }
        }
        
        function clearOrder(index) {
            const personName = orders[index].personName; 
            
            if (confirm(`ç¢ºå®šè¦æ¸…ç©º ${personName} çš„æ‰€æœ‰è¨‚é¤å…§å®¹å—ï¼Ÿ`)) {
                orders[index] = createNewOrder(personName);
                renderOrders();
            }
        }
        
        function deleteOrder(index) {
            if (index < INITIAL_NAMES.length) {
                alert("æ­¤ç‚ºå›ºå®šè¨‚é¤äººï¼Œä¸èƒ½åˆªé™¤ï¼Œåªèƒ½æ¸…ç©ºã€‚");
                return;
            }
            if (confirm(`ç¢ºå®šè¦åˆªé™¤ ${orders[index].personName} çš„è¨‚å–®å—ï¼Ÿ`)) {
                orders.splice(index, 1);
                
                document.getElementById('person-select').value = 0; 

                renderPersonSelect();
                renderOrders();
            }
        }


        function calculateTotal() {
            const totalPriceSpan = document.getElementById('total-price');
            
            const grandTotal = orders.reduce((sum, order) => {
                let extraSidesTotal = order.extraSides.reduce((esSum, item) => esSum + item.price, 0);
                const subtotal = order.mainItem.price + order.sideItem.price + order.drink.price + extraSidesTotal;
                return sum + subtotal;
            }, 0);

            totalPriceSpan.textContent = `HK$ ${grandTotal.toFixed(2)}`;
        }

        function saveOrdersToStorage() {
            try {
                const dataToSave = {
                    orders: orders,
                };
                localStorage.setItem('mcdonaldsGroupOrder', JSON.stringify(dataToSave));
            } catch (e) {
                console.error("ç„¡æ³•å„²å­˜è¨‚å–®åˆ° localStorage:", e);
            }
        }

        function loadOrdersFromStorage() {
            const savedData = localStorage.getItem('mcdonaldsGroupOrder');
            
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    orders = data.orders || [];
                    
                    if (orders.length < INITIAL_NAMES.length) throw new Error("Saved orders too short.");
                    
                    orders.forEach(order => {
                        if (!order.extraSides) order.extraSides = [];
                        if (!order.drink) order.drink = { name: 'ç„¡', price: 0, code: '' }; 
                        if (!order.sideItem) order.sideItem = { name: 'ç„¡', price: 0, code: '' };
                        if (order.mainItem && order.mainItem.isMaxSet === undefined) order.mainItem.isMaxSet = false; 
                        
                        // ç¢ºä¿ Fries_M æ˜¯æ¨™æº–é è¨­å€¼
                         if (order.mainItem.isSet && !order.mainItem.isMaxSet && order.sideItem.code === '' && order.sideItem.name === 'ç„¡') {
                             order.sideItem = { name: 'æ¨™æº–è–¯æ¢ M', price: 0, code: 'Fries_M' };
                         } else if (order.mainItem.isMaxSet && order.sideItem.code === '' && order.sideItem.name === 'ç„¡') {
                              order.sideItem = { name: 'å¤§è–¯æ¢ L', price: 0, code: 'Fries_L' };
                         }
                        
                        // èˆŠç‰ˆæ•¸æ“šçµæ§‹å•é¡Œä¿®æ­£ (ä¿æŒå‘ä¸‹å…¼å®¹)
                        if (order.mainItem.name === 'ç„¡' && order.sideItem.price > 0 && order.sideItem.name !== 'ç„¡' && order.extraSides.length === 0) {
                            const sideItemNameBefore = order.sideItem.name;
                            const sideItemPriceBefore = order.sideItem.price;

                            if (sideItemNameBefore.includes('+')) {
                                sideItemNameBefore.split(' + ').forEach(name => {
                                    order.extraSides.push({ name: name.trim(), price: 0, code: '' }); 
                                });
                                order.extraSides[0].price = sideItemPriceBefore; 
                            } else {
                                order.extraSides.push({ name: sideItemNameBefore, price: sideItemPriceBefore, code: '' });
                            }
                            order.sideItem = { name: 'ç„¡', price: 0, code: '' }; 
                        }
                    });
                    
                    for(let i = 0; i < INITIAL_NAMES.length; i++) {
                        if (orders[i]) {
                             orders[i].personName = INITIAL_NAMES[i];
                        }
                    }
                    
                    return;
                } catch (e) {
                    console.error("è¼‰å…¥è¨‚å–®å¤±æ•—æˆ–æ•¸æ“šæå£ï¼Œå°‡é‡æ–°åˆå§‹åŒ–ã€‚", e);
                }
            }
            
            orders = INITIAL_NAMES.map(name => createNewOrder(name));
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>